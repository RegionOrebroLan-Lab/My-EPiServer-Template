<Project>
	<Target Name="CopyFiles" BeforeTargets="BeforeBuild" Condition="@(FileToCopy) != ''">
		<Message
			Condition="%(CopyAlways) OR (!Exists('%(DestinationFile)') OR $([System.DateTime]::Parse('%(ModifiedTime)').Ticks) > $([System.IO.File]::GetLastWriteTime('%(DestinationFile)').Ticks))"
			Importance="high"
			Text="Target 'CopyFiles': Copying '%(FileToCopy.FullPath)' to '%(DestinationFile)'."
		/>
		<Copy
			Condition="%(CopyAlways) OR (!Exists('%(DestinationFile)') OR $([System.DateTime]::Parse('%(ModifiedTime)').Ticks) > $([System.IO.File]::GetLastWriteTime('%(DestinationFile)').Ticks))"
			DestinationFiles="%(DestinationFile)"
			SourceFiles="%(FileToCopy.FullPath)"
		/>
	</Target>
	<Target Name="EnsureConnectionsFile" BeforeTargets="PrepareForRun">
		<PropertyGroup>
			<_DestinationFile>Connections.config</_DestinationFile>
			<_SourceFile>Connections.Default.config</_SourceFile>
		</PropertyGroup>
		<Message
			Condition="!Exists('$(_DestinationFile)') AND Exists('$(_SourceFile)')"
			Importance="high"
			Text="Copying the file '$(_SourceFile)' to '$(_DestinationFile)'."
		/>
		<Warning
			Condition="!Exists('$(_SourceFile)')"
			Text="The file '$(_SourceFile)' does not exist."
		/>
		<Copy
			Condition="!Exists('$(_DestinationFile)') AND Exists('$(_SourceFile)')"
			DestinationFiles="$(_DestinationFile)"
			SourceFiles="$(_SourceFile)"
		/>
	</Target>
	<Target Name="ValidateCopyFiles" AfterTargets="BeforeBuild">
		<PropertyGroup>
			<EPiServerCmsModuleWebConfigPath>Modules\_Protected\CMS\Web.config</EPiServerCmsModuleWebConfigPath>
			<EPiServerGeolocationFilePath>App_Data\GeoLiteCity.dat</EPiServerGeolocationFilePath>
		</PropertyGroup>
		<Error
			Condition="!Exists('$(EPiServerGeolocationFilePath)') AND @(FileToCopy) == ''"
			Text="The files to copy are unexpectedly empty. Try rebuild the solution again."
		/>
		<Error
			Condition="!Exists('$(EPiServerGeolocationFilePath)') OR !Exists('$(EPiServerCmsModuleWebConfigPath)')"
			Text="The EPiServer-modules and the EPiServer-geolocation-file has not been copied. Try rebuild the solution again."
		/>
	</Target>
</Project>